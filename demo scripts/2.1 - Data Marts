USE ROLE GUIDEWIRE_ADMIN;

/* CREATING A DATA MART */
--STEP 1: Create a Schema and/or database
CREATE or replace SCHEMA GUIDEWIRE_CDA.STAGING;

-- STEP 2: Add your views
CREATE VIEW GUIDEWIRE_CDA.STAGING.BC_CHARGEPT_NM_L10N_VW AS
    SELECT ID, LANGUAGE,OWNER,PUBLICID,VALUE,NEW_COLUMN
    FROM "GUIDEWIRE_CDA"."RAW"."BC_CHARGEPT_NM_L10N"
    WHERE GWCBI___TX_ID = (SELECT MAX(GWCBI___TX_ID) FROM "GUIDEWIRE_CDA"."RAW"."BC_CHARGEPT_NM_L10N")
;

CREATE VIEW GUIDEWIRE_CDA.STAGING.BC_TACCOUNTPATTERN_VW AS
    SELECT ID, PUBLICID,RETIRED,SUBTYPE,SUFFIX,TACCOUNTLAZYLOADED,TACCOUNTNAME,TACCOUNTOWNERPATTERNID,TACCOUNTTYPE,UPDATETIME,UPDATEUSERID
    FROM "GUIDEWIRE_CDA"."RAW"."BC_TACCOUNTPATTERN"
    WHERE GWCBI___TX_ID = (SELECT MAX(GWCBI___TX_ID) FROM "GUIDEWIRE_CDA"."RAW"."BC_CHARGEPT_NM_L10N")
;

-- STEP 3: Add some compute for users to use, or re-use existing compute cluster
CREATE OR REPLACE WAREHOUSE CLUSTER_1_WH;
GRANT USAGE ON WAREHOUSE GW_CONSUMPTION_WH TO ROLE GW_ANALYST;

USE ROLE GW_ANALYST;
USE WAREHOUSE GW_CONSUMPTION_WH;
SELECT * FROM GUIDEWIRE_CDA.STAGING.BC_CHARGEPT_NM_L10N_VW;
SELECT * FROM GUIDEWIRE_CDA.STAGING.BC_TACCOUNTPATTERN_VW;

/* OPTION: Create zero-copy clone dev environments at will */
-- USE ROLE ACCOUNTADMIN;
-- CREATE DATABASE GUIDEWIRE_CDA_CLONE CLONE GUIDEWIRE_CDA;